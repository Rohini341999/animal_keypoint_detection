# Horse Keypoint ROS2 Workspace

This workspace implements:
- Gazebo world with multiple horse models (`horse_pose_sim/worlds/horse_arena.world`)
- TurtleBot3 (`burger_cam`) spawned in world
- YOLO keypoint detection on `/camera/image_raw`
- Custom keypoint message flow between two nodes
- RViz2 visualization for keypoint overlay images

## 1) Inspect horse scales (already prepared)

Generated files:
- `horse_model_map.csv`
- `horse_model_map.json`

These are generated by:
```bash
flatpak run --filesystem=/home/roha/Documents/horse_26kp/ros2_ws \
  org.blender.Blender --background --python /home/roha/Documents/horse_26kp/ros2_ws/inspect_horses.py
```

## 2) Install Python deps

```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./install_python_deps.sh
```

## 3) Build

```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
source /opt/ros/jazzy/setup.bash
colcon build --symlink-install
```

## 4) Run (recommended: multi terminal)

Terminal 1:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./run_terminal_1_sim.sh
```

Terminal 2:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./run_terminal_2_perception.sh
```

Terminal 3:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./run_terminal_3_rviz.sh
```

Optional pose debug terminal:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./run_terminal_4_pose_debug.sh
```

Pipeline health check:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./check_topics.sh
```

## 5) Screenshot capture

After focusing Gazebo or RViz window in your desktop session:
```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./capture_display_frame.sh screenshots/gazebo_01.png
./capture_display_frame.sh screenshots/rviz2_01.png
```

## 6) Video capture

```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./record_demo_video.sh videos/horse_demo.mp4
# Stop with Ctrl+C
```

## 7) Clean rebuild

```bash
cd /home/roha/Documents/horse_26kp/ros2_ws
./clean.sh
```

## Troubleshooting

If you saw:
`/opt/ros/jazzy/setup.bash: line 8: AMENT_TRACE_SETUP_FILES: unbound variable`

It is a shell `nounset` issue. The run scripts were patched to handle this. Pull latest files and run the scripts again.
